<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
      BoothPulse AI - Geo-Intelligent Governance Intelligence Engine
    </title>

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Leaflet.js CDN -->
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <!-- Leaflet MarkerCluster -->
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.css"
    />
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.Default.css"
    />
    <script src="https://unpkg.com/leaflet.markercluster@1.4.1/dist/leaflet.markercluster.js"></script>

    <!-- Google Fonts -->
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
      rel="stylesheet"
    />

    <!-- Custom Tailwind Config -->
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              "gov-blue": "#0f172a",
              "gov-blue-light": "#1e3a5f",
              "gov-accent": "#3b82f6",
              "gov-accent-light": "#60a5fa",
              glass: "rgba(255, 255, 255, 0.1)",
              "glass-dark": "rgba(15, 23, 42, 0.8)",
            },
            fontFamily: {
              inter: ["Inter", "sans-serif"],
            },
            backdropBlur: {
              glass: "20px",
            },
          },
        },
      };
    </script>

    <style>
      * {
        font-family: "Inter", sans-serif;
      }

      body {
        background: linear-gradient(
          135deg,
          #0f172a 0%,
          #1e3a5f 50%,
          #0f172a 100%
        );
        min-height: 100vh;
      }

      /* Glassmorphism Cards */
      .glass-card {
        background: rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        transition: all 0.3s ease;
      }

      .glass-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 16px 48px rgba(59, 130, 246, 0.2);
        border-color: rgba(59, 130, 246, 0.3);
      }

      /* Map Container */
      #map {
        height: 400px;
        border-radius: 16px;
        z-index: 1;
      }

      /* Custom Scrollbar */
      .custom-scroll::-webkit-scrollbar {
        width: 6px;
      }

      .custom-scroll::-webkit-scrollbar-track {
        background: rgba(255, 255, 255, 0.05);
        border-radius: 3px;
      }

      .custom-scroll::-webkit-scrollbar-thumb {
        background: rgba(59, 130, 246, 0.5);
        border-radius: 3px;
      }

      .custom-scroll::-webkit-scrollbar-thumb:hover {
        background: rgba(59, 130, 246, 0.7);
      }

      /* Animations */
      @keyframes pulse-glow {
        0%,
        100% {
          box-shadow: 0 0 20px rgba(239, 68, 68, 0.5);
        }
        50% {
          box-shadow: 0 0 40px rgba(239, 68, 68, 0.8);
        }
      }

      .pulse-glow {
        animation: pulse-glow 2s infinite;
      }

      @keyframes fade-in {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .fade-in {
        animation: fade-in 0.5s ease-out;
      }

      @keyframes slide-in-right {
        from {
          opacity: 0;
          transform: translateX(20px);
        }
        to {
          opacity: 1;
          transform: translateX(0);
        }
      }

      .slide-in-right {
        animation: slide-in-right 0.3s ease-out;
      }

      /* Loading Spinner */
      .spinner {
        border: 3px solid rgba(255, 255, 255, 0.1);
        border-top-color: #3b82f6;
        border-radius: 50%;
        width: 24px;
        height: 24px;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      /* Gauge Meter */
      .gauge-container {
        position: relative;
        width: 180px;
        height: 100px;
        margin: 0 auto;
      }

      .gauge-bg {
        fill: none;
        stroke: rgba(255, 255, 255, 0.1);
        stroke-width: 20;
      }

      .gauge-fill {
        fill: none;
        stroke-width: 20;
        stroke-linecap: round;
        transition:
          stroke-dashoffset 1s ease-in-out,
          stroke 0.5s ease;
      }

      /* Sentiment Badge Colors */
      .badge-positive {
        background: linear-gradient(135deg, #10b981, #34d399);
      }

      .badge-negative {
        background: linear-gradient(135deg, #ef4444, #f87171);
      }

      .badge-neutral {
        background: linear-gradient(135deg, #6b7280, #9ca3af);
      }

      /* Alert Severity */
      .alert-high {
        border-left: 4px solid #ef4444;
        background: rgba(239, 68, 68, 0.1);
      }

      .alert-medium {
        border-left: 4px solid #f59e0b;
        background: rgba(245, 158, 11, 0.1);
      }

      .alert-low {
        border-left: 4px solid #10b981;
        background: rgba(16, 185, 129, 0.1);
      }

      /* Header Sticky */
      .sticky-header {
        position: sticky;
        top: 0;
        z-index: 50;
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
      }

      /* Select Styling */
      select {
        background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
        background-position: right 0.5rem center;
        background-repeat: no-repeat;
        background-size: 1.5em 1.5em;
        padding-right: 2.5rem;
        background-color: #1e293b !important;
        color: white !important;
      }

      select option {
        background-color: #1e293b !important;
        color: white !important;
        padding: 10px;
      }

      select option:hover,
      select option:focus,
      select option:checked {
        background-color: #3b82f6 !important;
        color: white !important;
      }

      select:focus {
        background-color: #1e293b !important;
      }

      /* Tooltip */
      .tooltip {
        position: relative;
      }

      .tooltip:hover::after {
        content: attr(data-tooltip);
        position: absolute;
        bottom: 100%;
        left: 50%;
        transform: translateX(-50%);
        padding: 0.5rem 1rem;
        background: rgba(0, 0, 0, 0.9);
        color: white;
        font-size: 0.75rem;
        border-radius: 6px;
        white-space: nowrap;
        z-index: 100;
      }
    </style>
  </head>
  <body class="text-white">
    <!-- Header -->
    <header class="sticky-header bg-gov-blue/90 border-b border-white/10">
      <div class="container mx-auto px-6 py-4">
        <div class="flex items-center justify-between">
          <div class="flex items-center gap-4">
            <div
              class="w-12 h-12 rounded-xl bg-gradient-to-br from-gov-accent to-gov-accent-light flex items-center justify-center"
            >
              <svg
                class="w-7 h-7 text-white"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"
                />
              </svg>
            </div>
            <div>
              <h1
                class="text-2xl font-bold bg-gradient-to-r from-white to-gov-accent-light bg-clip-text text-transparent"
              >
                BoothPulse AI
              </h1>
              <p class="text-sm text-gray-400">
                Geo-Intelligent Governance Intelligence Engine
              </p>
            </div>
          </div>

          <div class="flex items-center gap-4">
            <!-- Early Warning Badge -->
            <div id="early-warning-badge" class="hidden">
              <span
                class="bg-red-500/20 border border-red-500 text-red-400 px-4 py-2 rounded-full font-semibold flex items-center gap-2 pulse-glow"
              >
                <svg
                  class="w-5 h-5"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"
                  />
                </svg>
                Early Warning Active
              </span>
            </div>

            <!-- Alert Counter -->
            <button
              onclick="toggleAlertCenter()"
              class="relative p-2 rounded-lg bg-white/5 hover:bg-white/10 transition"
            >
              <svg
                class="w-6 h-6"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"
                />
              </svg>
              <span
                id="alert-badge"
                class="hidden absolute -top-1 -right-1 w-5 h-5 bg-red-500 rounded-full text-xs flex items-center justify-center font-bold"
                >0</span
              >
            </button>
          </div>
        </div>
      </div>
    </header>

    <main class="container mx-auto px-6 py-8">
      <!-- Stats Cards Row -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4 mb-8">
        <!-- Total Feedback -->
        <div class="glass-card rounded-2xl p-5">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-gray-400 text-sm font-medium">Total Feedback</p>
              <p id="total-feedback" class="text-3xl font-bold text-white mt-1">
                0
              </p>
            </div>
            <div
              class="w-12 h-12 rounded-xl bg-gov-accent/20 flex items-center justify-center"
            >
              <svg
                class="w-6 h-6 text-gov-accent"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"
                />
              </svg>
            </div>
          </div>
        </div>

        <!-- Positive -->
        <div class="glass-card rounded-2xl p-5">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-gray-400 text-sm font-medium">Positive</p>
              <p
                id="positive-pct"
                class="text-3xl font-bold text-emerald-400 mt-1"
              >
                0%
              </p>
            </div>
            <div
              class="w-12 h-12 rounded-xl bg-emerald-500/20 flex items-center justify-center"
            >
              <svg
                class="w-6 h-6 text-emerald-400"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M14.828 14.828a4 4 0 01-5.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
                />
              </svg>
            </div>
          </div>
        </div>

        <!-- Negative -->
        <div class="glass-card rounded-2xl p-5">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-gray-400 text-sm font-medium">Negative</p>
              <p id="negative-pct" class="text-3xl font-bold text-red-400 mt-1">
                0%
              </p>
            </div>
            <div
              class="w-12 h-12 rounded-xl bg-red-500/20 flex items-center justify-center"
            >
              <svg
                class="w-6 h-6 text-red-400"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
                />
              </svg>
            </div>
          </div>
        </div>

        <!-- Neutral -->
        <div class="glass-card rounded-2xl p-5">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-gray-400 text-sm font-medium">Neutral</p>
              <p id="neutral-pct" class="text-3xl font-bold text-gray-400 mt-1">
                0%
              </p>
            </div>
            <div
              class="w-12 h-12 rounded-xl bg-gray-500/20 flex items-center justify-center"
            >
              <svg
                class="w-6 h-6 text-gray-400"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M8 12h.01M12 12h.01M16 12h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
                />
              </svg>
            </div>
          </div>
        </div>

        <!-- Risk Index -->
        <div class="glass-card rounded-2xl p-5">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-gray-400 text-sm font-medium">Risk Index</p>
              <p
                id="risk-index-value"
                class="text-3xl font-bold text-yellow-400 mt-1"
              >
                0
              </p>
            </div>
            <div
              class="w-12 h-12 rounded-xl bg-yellow-500/20 flex items-center justify-center"
            >
              <svg
                class="w-6 h-6 text-yellow-400"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M13 10V3L4 14h7v7l9-11h-7z"
                />
              </svg>
            </div>
          </div>
        </div>
      </div>

      <!-- Main Grid -->
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
        <!-- Submit Section -->
        <div class="lg:col-span-1">
          <div class="glass-card rounded-2xl p-6 h-full">
            <h2
              class="text-xl font-bold text-white mb-6 flex items-center gap-3"
            >
              <div
                class="w-8 h-8 rounded-lg bg-gov-accent/20 flex items-center justify-center"
              >
                <svg
                  class="w-5 h-5 text-gov-accent"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"
                  />
                </svg>
              </div>
              Geo-Intelligent Input
            </h2>

            <form id="feedback-form" class="space-y-4">
              <!-- Feedback Text -->
              <div>
                <label class="block text-sm font-medium text-gray-300 mb-2"
                  >Public Feedback</label
                >
                <textarea
                  id="feedback-text"
                  rows="3"
                  class="w-full px-4 py-3 bg-white/5 border border-white/10 rounded-xl text-white placeholder-gray-500 focus:ring-2 focus:ring-gov-accent focus:border-transparent resize-none transition"
                  placeholder="Enter feedback... (e.g., 'Water supply is irregular in our area')"
                ></textarea>
              </div>

              <!-- Country -->
              <div>
                <label class="block text-sm font-medium text-gray-300 mb-2"
                  >Country</label
                >
                <select
                  id="country-select"
                  class="w-full px-4 py-2.5 border border-white/10 rounded-xl text-white focus:ring-2 focus:ring-gov-accent focus:border-transparent transition cursor-pointer"
                  style="background-color: #1e293b"
                >
                  <option
                    value=""
                    style="background-color: #1e293b; color: white"
                  >
                    Select Country
                  </option>
                </select>
              </div>

              <!-- State -->
              <div>
                <label class="block text-sm font-medium text-gray-300 mb-2"
                  >State/Province</label
                >
                <select
                  id="state-select"
                  class="w-full px-4 py-2.5 border border-white/10 rounded-xl text-white focus:ring-2 focus:ring-gov-accent focus:border-transparent transition cursor-pointer"
                  style="background-color: #1e293b"
                  disabled
                >
                  <option
                    value=""
                    style="background-color: #1e293b; color: white"
                  >
                    Select State
                  </option>
                </select>
              </div>

              <!-- City -->
              <div>
                <label class="block text-sm font-medium text-gray-300 mb-2"
                  >City</label
                >
                <select
                  id="city-select"
                  class="w-full px-4 py-2.5 border border-white/10 rounded-xl text-white focus:ring-2 focus:ring-gov-accent focus:border-transparent transition cursor-pointer"
                  style="background-color: #1e293b"
                  disabled
                >
                  <option
                    value=""
                    style="background-color: #1e293b; color: white"
                  >
                    Select City
                  </option>
                </select>
              </div>

              <!-- Manual Location Toggle -->
              <div>
                <button
                  type="button"
                  onclick="toggleManualLocation()"
                  class="text-sm text-gov-accent hover:text-gov-accent-light flex items-center gap-2 transition"
                >
                  <svg
                    id="manual-toggle-icon"
                    class="w-4 h-4 transition-transform"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M19 9l-7 7-7-7"
                    />
                  </svg>
                  Advanced Location Input (Optional)
                </button>
              </div>

              <!-- Manual Location Fields (Hidden by default) -->
              <div
                id="manual-location"
                class="hidden space-y-4 pt-2 border-t border-white/10"
              >
                <div class="grid grid-cols-2 gap-4">
                  <div>
                    <label class="block text-xs font-medium text-gray-400 mb-1"
                      >Street Name</label
                    >
                    <input
                      type="text"
                      id="street-input"
                      class="w-full px-3 py-2 bg-white/5 border border-white/10 rounded-lg text-white text-sm placeholder-gray-500 focus:ring-2 focus:ring-gov-accent focus:border-transparent transition"
                      placeholder="Street name"
                    />
                  </div>
                  <div>
                    <label class="block text-xs font-medium text-gray-400 mb-1"
                      >Landmark</label
                    >
                    <input
                      type="text"
                      id="landmark-input"
                      class="w-full px-3 py-2 bg-white/5 border border-white/10 rounded-lg text-white text-sm placeholder-gray-500 focus:ring-2 focus:ring-gov-accent focus:border-transparent transition"
                      placeholder="Near landmark"
                    />
                  </div>
                </div>
                <div class="grid grid-cols-2 gap-4">
                  <div>
                    <label class="block text-xs font-medium text-gray-400 mb-1"
                      >Ward</label
                    >
                    <input
                      type="text"
                      id="ward-input"
                      class="w-full px-3 py-2 bg-white/5 border border-white/10 rounded-lg text-white text-sm placeholder-gray-500 focus:ring-2 focus:ring-gov-accent focus:border-transparent transition"
                      placeholder="Ward number"
                    />
                  </div>
                  <div>
                    <label class="block text-xs font-medium text-gray-400 mb-1"
                      >Booth Number</label
                    >
                    <input
                      type="text"
                      id="booth-input"
                      class="w-full px-3 py-2 bg-white/5 border border-white/10 rounded-lg text-white text-sm placeholder-gray-500 focus:ring-2 focus:ring-gov-accent focus:border-transparent transition"
                      placeholder="Booth #"
                    />
                  </div>
                </div>
                <button
                  type="button"
                  onclick="resolveGeoLocation()"
                  class="w-full py-2 bg-white/5 border border-white/10 rounded-lg text-sm text-gray-300 hover:bg-white/10 transition flex items-center justify-center gap-2"
                >
                  <svg
                    class="w-4 h-4"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"
                    />
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"
                    />
                  </svg>
                  Auto-Resolve Coordinates
                </button>
                <div
                  id="geo-status"
                  class="hidden text-xs text-center py-2 rounded-lg"
                ></div>
              </div>

              <!-- Submit Button -->
              <button
                type="submit"
                id="submit-btn"
                class="w-full py-3 bg-gradient-to-r from-gov-accent to-gov-accent-light text-white font-semibold rounded-xl hover:opacity-90 transition flex items-center justify-center gap-2 mt-4"
              >
                <span id="submit-text">Analyze Sentiment</span>
                <div id="submit-spinner" class="hidden spinner"></div>
              </button>
            </form>

            <!-- Result Display -->
            <div
              id="result-container"
              class="hidden mt-6 pt-6 border-t border-white/10 fade-in"
            >
              <h3 class="font-semibold text-white mb-3 flex items-center gap-2">
                <svg
                  class="w-5 h-5 text-gov-accent"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"
                  />
                </svg>
                Analysis Result
              </h3>
              <div id="result-card" class="rounded-xl p-4 text-white">
                <div class="flex items-center justify-between mb-3">
                  <span
                    id="result-sentiment"
                    class="text-lg font-bold uppercase px-3 py-1 rounded-lg"
                  ></span>
                  <span
                    id="result-confidence"
                    class="text-sm opacity-80 bg-white/10 px-2 py-1 rounded"
                  ></span>
                </div>
                <div class="text-sm space-y-2 text-gray-200">
                  <p class="flex items-center gap-2">
                    <svg
                      class="w-4 h-4 text-gray-400"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"
                      />
                    </svg>
                    <strong>Issue:</strong> <span id="result-issue"></span>
                  </p>
                  <p class="flex items-center gap-2">
                    <svg
                      class="w-4 h-4 text-gray-400"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"
                      />
                    </svg>
                    <strong>Location:</strong>
                    <span id="result-location"></span>
                  </p>
                  <p class="flex items-center gap-2">
                    <svg
                      class="w-4 h-4 text-gray-400"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"
                      />
                    </svg>
                    <strong>Time:</strong> <span id="result-time"></span>
                  </p>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Risk Gauge & Activity -->
        <div class="lg:col-span-2 space-y-6">
          <!-- Risk Gauge and AI Summary -->
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- Sentiment Risk Gauge -->
            <div class="glass-card rounded-2xl p-6">
              <h3
                class="text-lg font-semibold text-white mb-4 flex items-center gap-2"
              >
                <svg
                  class="w-5 h-5 text-yellow-400"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M13 10V3L4 14h7v7l9-11h-7z"
                  />
                </svg>
                Sentiment Risk Index
              </h3>
              <div class="gauge-container">
                <svg viewBox="0 0 200 120" class="w-full">
                  <path
                    class="gauge-bg"
                    d="M 20 100 A 80 80 0 0 1 180 100"
                  ></path>
                  <path
                    id="gauge-fill"
                    class="gauge-fill"
                    d="M 20 100 A 80 80 0 0 1 180 100"
                    stroke="#10b981"
                    stroke-dasharray="251.2"
                    stroke-dashoffset="251.2"
                  ></path>
                </svg>
                <div
                  class="absolute inset-0 flex items-end justify-center pb-2"
                >
                  <span id="gauge-value" class="text-4xl font-bold">0</span>
                </div>
              </div>
              <div class="flex justify-between text-xs text-gray-400 mt-2 px-4">
                <span class="text-emerald-400">Safe (0-30)</span>
                <span class="text-yellow-400">Caution (31-60)</span>
                <span class="text-red-400">Critical (61-100)</span>
              </div>
            </div>

            <!-- AI Intelligence Summary -->
            <div class="glass-card rounded-2xl p-6">
              <h3
                class="text-lg font-semibold text-white mb-4 flex items-center gap-2"
              >
                <svg
                  class="w-5 h-5 text-purple-400"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"
                  />
                </svg>
                AI Intelligence Briefing
              </h3>
              <div
                id="ai-summary"
                class="text-sm text-gray-300 leading-relaxed custom-scroll max-h-32 overflow-y-auto"
              >
                <p class="text-gray-500 italic">
                  No analysis data yet. Submit feedback to generate intelligence
                  insights.
                </p>
              </div>
            </div>
          </div>

          <!-- Activity Feed -->
          <div class="glass-card rounded-2xl p-6">
            <h3
              class="text-lg font-semibold text-white mb-4 flex items-center gap-2"
            >
              <svg
                class="w-5 h-5 text-gov-accent"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M13 10V3L4 14h7v7l9-11h-7z"
                />
              </svg>
              Live Activity Feed
            </h3>
            <div
              id="activity-feed"
              class="custom-scroll max-h-48 overflow-y-auto space-y-3"
            >
              <p class="text-gray-500 italic text-center py-8">
                No feedback submitted yet. Start by submitting your first
                feedback!
              </p>
            </div>
          </div>
        </div>
      </div>

      <!-- Charts Section -->
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
        <!-- Sentiment Timeline -->
        <div class="glass-card rounded-2xl p-6">
          <h3
            class="text-lg font-semibold text-white mb-4 flex items-center gap-2"
          >
            <svg
              class="w-5 h-5 text-blue-400"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M7 12l3-3 3 3 4-4M8 21l4-4 4 4M3 4h18M4 4h16v12a1 1 0 01-1 1H5a1 1 0 01-1-1V4z"
              />
            </svg>
            Sentiment Timeline
          </h3>
          <div class="h-48">
            <canvas id="timeline-chart"></canvas>
          </div>
        </div>

        <!-- Issue Density -->
        <div class="glass-card rounded-2xl p-6">
          <h3
            class="text-lg font-semibold text-white mb-4 flex items-center gap-2"
          >
            <svg
              class="w-5 h-5 text-orange-400"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"
              />
            </svg>
            Issue Density
          </h3>
          <div class="h-48">
            <canvas id="issue-chart"></canvas>
          </div>
        </div>

        <!-- Sentiment Distribution -->
        <div class="glass-card rounded-2xl p-6">
          <h3
            class="text-lg font-semibold text-white mb-4 flex items-center gap-2"
          >
            <svg
              class="w-5 h-5 text-pink-400"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M11 3.055A9.001 9.001 0 1020.945 13H11V3.055z"
              />
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M20.488 9H15V3.512A9.025 9.025 0 0120.488 9z"
              />
            </svg>
            Sentiment Distribution
          </h3>
          <div class="h-48">
            <canvas id="sentiment-chart"></canvas>
          </div>
        </div>
      </div>

      <!-- Map Section -->
      <div class="glass-card rounded-2xl p-6 mb-8">
        <h3
          class="text-lg font-semibold text-white mb-4 flex items-center gap-2"
        >
          <svg
            class="w-5 h-5 text-emerald-400"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"
            />
          </svg>
          Geo-Intensity Map
          <span class="text-xs text-gray-400 ml-2"
            >(Clustered by sentiment intensity)</span
          >
        </h3>
        <div id="map" class="rounded-xl overflow-hidden"></div>
        <div class="flex justify-center gap-6 mt-4 text-sm">
          <div class="flex items-center gap-2">
            <div class="w-4 h-4 rounded-full bg-emerald-500"></div>
            <span class="text-gray-400">Positive</span>
          </div>
          <div class="flex items-center gap-2">
            <div class="w-4 h-4 rounded-full bg-red-500"></div>
            <span class="text-gray-400">Negative</span>
          </div>
          <div class="flex items-center gap-2">
            <div class="w-4 h-4 rounded-full bg-gray-500"></div>
            <span class="text-gray-400">Neutral</span>
          </div>
        </div>
      </div>

      <!-- City Stats Table -->
      <div class="glass-card rounded-2xl p-6">
        <h3
          class="text-lg font-semibold text-white mb-4 flex items-center gap-2"
        >
          <svg
            class="w-5 h-5 text-cyan-400"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"
            />
          </svg>
          City-wise Sentiment Analysis
        </h3>
        <div class="overflow-x-auto custom-scroll">
          <table class="w-full text-sm">
            <thead>
              <tr class="text-gray-400 border-b border-white/10">
                <th class="text-left py-3 px-4">City</th>
                <th class="text-center py-3 px-4">Total</th>
                <th class="text-center py-3 px-4">Positive</th>
                <th class="text-center py-3 px-4">Negative</th>
                <th class="text-center py-3 px-4">Neutral</th>
                <th class="text-center py-3 px-4">Risk %</th>
              </tr>
            </thead>
            <tbody id="city-stats-body">
              <tr>
                <td colspan="6" class="text-center py-8 text-gray-500 italic">
                  No city data available
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </main>

    <!-- Alert Center Sidebar -->
    <div
      id="alert-center"
      class="fixed top-0 right-0 w-96 h-full bg-gov-blue/95 backdrop-blur-xl border-l border-white/10 transform translate-x-full transition-transform z-50 overflow-hidden"
    >
      <div class="h-full flex flex-col">
        <div class="p-6 border-b border-white/10">
          <div class="flex items-center justify-between">
            <h2 class="text-xl font-bold text-white flex items-center gap-2">
              <svg
                class="w-6 h-6 text-red-400"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"
                />
              </svg>
              Alert Center
            </h2>
            <button
              onclick="toggleAlertCenter()"
              class="p-2 hover:bg-white/10 rounded-lg transition"
            >
              <svg
                class="w-5 h-5"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M6 18L18 6M6 6l12 12"
                />
              </svg>
            </button>
          </div>

          <!-- Alert Stats -->
          <div class="grid grid-cols-3 gap-3 mt-4">
            <div class="bg-red-500/20 rounded-lg p-3 text-center">
              <p id="alert-high" class="text-2xl font-bold text-red-400">0</p>
              <p class="text-xs text-gray-400">High</p>
            </div>
            <div class="bg-yellow-500/20 rounded-lg p-3 text-center">
              <p id="alert-medium" class="text-2xl font-bold text-yellow-400">
                0
              </p>
              <p class="text-xs text-gray-400">Medium</p>
            </div>
            <div class="bg-emerald-500/20 rounded-lg p-3 text-center">
              <p id="alert-low" class="text-2xl font-bold text-emerald-400">
                0
              </p>
              <p class="text-xs text-gray-400">Low</p>
            </div>
          </div>
        </div>

        <!-- Alert List -->
        <div
          id="alert-list"
          class="flex-1 overflow-y-auto custom-scroll p-4 space-y-3"
        >
          <p class="text-gray-500 italic text-center py-8">No alerts yet</p>
        </div>
      </div>
    </div>

    <!-- Overlay for Alert Center -->
    <div
      id="alert-overlay"
      class="fixed inset-0 bg-black/50 backdrop-blur-sm z-40 hidden"
      onclick="toggleAlertCenter()"
    ></div>

    <script>
      // ==================== GLOBAL STATE ====================
      let geoData = {};
      let resolvedCoordinates = null;
      let map = null;
      let markerCluster = null;
      let timelineChart = null;
      let issueChart = null;
      let sentimentChart = null;

      // ==================== INITIALIZATION ====================
      document.addEventListener("DOMContentLoaded", async () => {
        await loadGeoData();
        initMap();
        initCharts();
        loadDashboardData();
        loadAlerts();
        loadAISummary();

        // Auto-refresh every 30 seconds
        setInterval(() => {
          loadDashboardData();
          loadAlerts();
          loadAISummary();
        }, 30000);
      });

      // ==================== GEO DATA FUNCTIONS ====================
      async function loadGeoData() {
        try {
          const response = await fetch("/geo-data");
          geoData = await response.json();
          populateCountries();
        } catch (error) {
          console.error("Error loading geo data:", error);
        }
      }

      function populateCountries() {
        const countrySelect = document.getElementById("country-select");
        countrySelect.innerHTML =
          '<option value="" style="background-color: #1e293b; color: white;">Select Country</option>';

        geoData.countries.forEach((country) => {
          const option = document.createElement("option");
          option.value = country;
          option.textContent = country;
          option.style.backgroundColor = "#1e293b";
          option.style.color = "white";
          if (country === "India") option.selected = true;
          countrySelect.appendChild(option);
        });

        countrySelect.addEventListener("change", onCountryChange);

        // Trigger initial state load for India
        if (countrySelect.value) {
          onCountryChange();
        }
      }

      function onCountryChange() {
        const country = document.getElementById("country-select").value;
        const stateSelect = document.getElementById("state-select");
        const citySelect = document.getElementById("city-select");

        stateSelect.innerHTML =
          '<option value="" style="background-color: #1e293b; color: white;">Select State</option>';
        citySelect.innerHTML =
          '<option value="" style="background-color: #1e293b; color: white;">Select City</option>';
        citySelect.disabled = true;

        if (country && geoData.states_by_country[country]) {
          stateSelect.disabled = false;
          geoData.states_by_country[country].forEach((state) => {
            const option = document.createElement("option");
            option.value = state;
            option.textContent = state;
            option.style.backgroundColor = "#1e293b";
            option.style.color = "white";
            stateSelect.appendChild(option);
          });
          stateSelect.addEventListener("change", onStateChange);
        } else {
          stateSelect.disabled = true;
        }
      }

      function onStateChange() {
        const state = document.getElementById("state-select").value;
        const citySelect = document.getElementById("city-select");

        citySelect.innerHTML =
          '<option value="" style="background-color: #1e293b; color: white;">Select City</option>';

        if (state && geoData.cities_by_state[state]) {
          citySelect.disabled = false;
          geoData.cities_by_state[state].forEach((city) => {
            const option = document.createElement("option");
            option.value = city;
            option.textContent = city;
            option.style.backgroundColor = "#1e293b";
            option.style.color = "white";
            citySelect.appendChild(option);
          });
        } else {
          citySelect.disabled = true;
        }
      }

      // ==================== MANUAL LOCATION ====================
      function toggleManualLocation() {
        const container = document.getElementById("manual-location");
        const icon = document.getElementById("manual-toggle-icon");

        if (container.classList.contains("hidden")) {
          container.classList.remove("hidden");
          icon.style.transform = "rotate(180deg)";
        } else {
          container.classList.add("hidden");
          icon.style.transform = "rotate(0deg)";
        }
      }

      async function resolveGeoLocation() {
        const street = document.getElementById("street-input").value;
        const landmark = document.getElementById("landmark-input").value;
        const city = document.getElementById("city-select").value;
        const state = document.getElementById("state-select").value;
        const country = document.getElementById("country-select").value;

        const statusDiv = document.getElementById("geo-status");
        statusDiv.classList.remove("hidden");
        statusDiv.className =
          "text-xs text-center py-2 rounded-lg bg-blue-500/20 text-blue-400";
        statusDiv.textContent = "Resolving coordinates...";

        if (!city || !state || !country) {
          statusDiv.className =
            "text-xs text-center py-2 rounded-lg bg-yellow-500/20 text-yellow-400";
          statusDiv.textContent =
            "Please select country, state, and city first";
          return;
        }

        try {
          const query = [street, landmark, city, state, country]
            .filter(Boolean)
            .join(", ");
          const response = await fetch(
            `https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(query)}&format=json&limit=1`,
            {
              headers: { "User-Agent": "BoothPulseAI/2.0" },
            },
          );
          const data = await response.json();

          if (data.length > 0) {
            resolvedCoordinates = {
              lat: parseFloat(data[0].lat),
              lon: parseFloat(data[0].lon),
            };
            statusDiv.className =
              "text-xs text-center py-2 rounded-lg bg-emerald-500/20 text-emerald-400";
            statusDiv.textContent = `âœ“ Coordinates resolved: ${resolvedCoordinates.lat.toFixed(4)}, ${resolvedCoordinates.lon.toFixed(4)}`;
          } else {
            statusDiv.className =
              "text-xs text-center py-2 rounded-lg bg-yellow-500/20 text-yellow-400";
            statusDiv.textContent =
              "Location not found. Using city coordinates.";
            resolvedCoordinates = null;
          }
        } catch (error) {
          statusDiv.className =
            "text-xs text-center py-2 rounded-lg bg-red-500/20 text-red-400";
          statusDiv.textContent =
            "Error resolving location. Will use city coordinates.";
          resolvedCoordinates = null;
        }
      }

      // ==================== FORM SUBMISSION ====================
      document
        .getElementById("feedback-form")
        .addEventListener("submit", async (e) => {
          e.preventDefault();

          const text = document.getElementById("feedback-text").value.trim();
          if (!text) {
            alert("Please enter feedback text");
            return;
          }

          const submitBtn = document.getElementById("submit-btn");
          const submitText = document.getElementById("submit-text");
          const submitSpinner = document.getElementById("submit-spinner");

          // Show loading state
          submitBtn.disabled = true;
          submitText.textContent = "Analyzing...";
          submitSpinner.classList.remove("hidden");

          try {
            const payload = {
              text: text,
              country:
                document.getElementById("country-select").value || "India",
              state: document.getElementById("state-select").value || "",
              city: document.getElementById("city-select").value || "",
              street: document.getElementById("street-input").value || null,
              landmark: document.getElementById("landmark-input").value || null,
              ward: document.getElementById("ward-input").value || null,
              booth_number:
                document.getElementById("booth-input").value || null,
              lat: resolvedCoordinates?.lat || null,
              lon: resolvedCoordinates?.lon || null,
            };

            const response = await fetch("/analyze", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify(payload),
            });

            const result = await response.json();

            if (result.success) {
              displayResult(result.data);

              // Clear form
              document.getElementById("feedback-text").value = "";
              resolvedCoordinates = null;

              // Refresh dashboard
              loadDashboardData();
              loadAlerts();
              loadAISummary();

              // Show alert notification if triggered
              if (result.alert_triggered) {
                showNotification(
                  "ðŸš¨ Alert triggered for this location!",
                  "warning",
                );
              }
            }
          } catch (error) {
            console.error("Error:", error);
            showNotification("Error analyzing feedback", "error");
          } finally {
            // Reset button
            submitBtn.disabled = false;
            submitText.textContent = "Analyze Sentiment";
            submitSpinner.classList.add("hidden");
          }
        });

      function displayResult(data) {
        const container = document.getElementById("result-container");
        const card = document.getElementById("result-card");
        const sentiment = document.getElementById("result-sentiment");
        const confidence = document.getElementById("result-confidence");
        const issue = document.getElementById("result-issue");
        const location = document.getElementById("result-location");
        const time = document.getElementById("result-time");

        // Set sentiment styling
        if (data.sentiment === "positive") {
          card.className = "rounded-xl p-4 text-white badge-positive";
          sentiment.className =
            "text-lg font-bold uppercase px-3 py-1 rounded-lg bg-white/20";
        } else if (data.sentiment === "negative") {
          card.className = "rounded-xl p-4 text-white badge-negative";
          sentiment.className =
            "text-lg font-bold uppercase px-3 py-1 rounded-lg bg-white/20";
        } else {
          card.className = "rounded-xl p-4 text-white badge-neutral";
          sentiment.className =
            "text-lg font-bold uppercase px-3 py-1 rounded-lg bg-white/20";
        }

        sentiment.textContent = data.sentiment;
        confidence.textContent = `${(data.confidence * 100).toFixed(1)}% confidence`;
        issue.textContent = data.issue;
        location.textContent = `${data.city}, ${data.state}`;
        time.textContent = data.timestamp;

        container.classList.remove("hidden");
      }

      // ==================== DASHBOARD DATA ====================
      async function loadDashboardData() {
        try {
          const response = await fetch("/dashboard-data");
          const data = await response.json();

          // Update stats
          document.getElementById("total-feedback").textContent =
            data.total_feedback;
          document.getElementById("positive-pct").textContent =
            `${data.positive_pct}%`;
          document.getElementById("negative-pct").textContent =
            `${data.negative_pct}%`;
          document.getElementById("neutral-pct").textContent =
            `${data.neutral_pct}%`;
          document.getElementById("risk-index-value").textContent =
            data.risk_index;

          // Update risk index color
          const riskEl = document.getElementById("risk-index-value");
          if (data.risk_index < 30) {
            riskEl.className = "text-3xl font-bold text-emerald-400 mt-1";
          } else if (data.risk_index < 60) {
            riskEl.className = "text-3xl font-bold text-yellow-400 mt-1";
          } else {
            riskEl.className = "text-3xl font-bold text-red-400 mt-1";
          }

          // Update gauge
          updateGauge(data.risk_index);

          // Update early warning
          const warningBadge = document.getElementById("early-warning-badge");
          if (data.early_warning) {
            warningBadge.classList.remove("hidden");
          } else {
            warningBadge.classList.add("hidden");
          }

          // Update activity feed
          updateActivityFeed(data.recent_activity);

          // Update charts
          updateTimelineChart(data.timeline_data);
          updateIssueChart(data.issue_distribution);
          updateSentimentChart(data.sentiment_distribution);

          // Update map
          updateMap(data.geo_data);

          // Update city stats
          updateCityStats(data.city_stats);
        } catch (error) {
          console.error("Error loading dashboard data:", error);
        }
      }

      function updateGauge(value) {
        const gaugeFill = document.getElementById("gauge-fill");
        const gaugeValue = document.getElementById("gauge-value");

        // Calculate stroke offset (251.2 is the full arc length)
        const offset = 251.2 - (value / 100) * 251.2;
        gaugeFill.style.strokeDashoffset = offset;

        // Set color based on value
        if (value < 30) {
          gaugeFill.style.stroke = "#10b981";
        } else if (value < 60) {
          gaugeFill.style.stroke = "#f59e0b";
        } else {
          gaugeFill.style.stroke = "#ef4444";
        }

        gaugeValue.textContent = value;
      }

      function updateActivityFeed(activities) {
        const feed = document.getElementById("activity-feed");

        if (!activities || activities.length === 0) {
          feed.innerHTML =
            '<p class="text-gray-500 italic text-center py-8">No feedback submitted yet. Start by submitting your first feedback!</p>';
          return;
        }

        feed.innerHTML = activities
          .map((activity) => {
            const badgeClass =
              activity.sentiment === "positive"
                ? "badge-positive"
                : activity.sentiment === "negative"
                  ? "badge-negative"
                  : "badge-neutral";
            return `
                    <div class="bg-white/5 rounded-xl p-4 border border-white/5 slide-in-right">
                        <div class="flex items-start justify-between gap-4">
                            <div class="flex-1">
                                <p class="text-sm text-gray-300 line-clamp-2">${escapeHtml(activity.text)}</p>
                                <div class="flex items-center gap-3 mt-2 text-xs text-gray-500">
                                    <span>${activity.city || "Unknown"}</span>
                                    <span>â€¢</span>
                                    <span>${activity.issue}</span>
                                    <span>â€¢</span>
                                    <span>${activity.timestamp}</span>
                                </div>
                            </div>
                            <span class="${badgeClass} px-2 py-1 rounded text-xs font-semibold uppercase">${activity.sentiment}</span>
                        </div>
                    </div>
                `;
          })
          .join("");
      }

      function updateCityStats(stats) {
        const tbody = document.getElementById("city-stats-body");

        if (!stats || stats.length === 0) {
          tbody.innerHTML =
            '<tr><td colspan="6" class="text-center py-8 text-gray-500 italic">No city data available</td></tr>';
          return;
        }

        tbody.innerHTML = stats
          .map((city) => {
            const riskClass =
              city.negative_ratio > 60
                ? "text-red-400"
                : city.negative_ratio > 30
                  ? "text-yellow-400"
                  : "text-emerald-400";
            return `
                    <tr class="border-b border-white/5 hover:bg-white/5 transition">
                        <td class="py-3 px-4 font-medium text-white">${city.city}</td>
                        <td class="py-3 px-4 text-center text-gray-300">${city.total}</td>
                        <td class="py-3 px-4 text-center text-emerald-400">${city.positive}</td>
                        <td class="py-3 px-4 text-center text-red-400">${city.negative}</td>
                        <td class="py-3 px-4 text-center text-gray-400">${city.neutral}</td>
                        <td class="py-3 px-4 text-center ${riskClass} font-semibold">${city.negative_ratio}%</td>
                    </tr>
                `;
          })
          .join("");
      }

      // ==================== MAP FUNCTIONS ====================
      function initMap() {
        map = L.map("map").setView([20.5937, 78.9629], 5);

        L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
          attribution: "&copy; OpenStreetMap contributors",
        }).addTo(map);

        markerCluster = L.markerClusterGroup({
          spiderfyOnMaxZoom: true,
          showCoverageOnHover: false,
          maxClusterRadius: 50,
        });

        map.addLayer(markerCluster);
      }

      function updateMap(geoData) {
        if (!map || !markerCluster) return;

        markerCluster.clearLayers();

        if (!geoData || geoData.length === 0) return;

        geoData.forEach((point) => {
          const color =
            point.sentiment === "positive"
              ? "#10b981"
              : point.sentiment === "negative"
                ? "#ef4444"
                : "#6b7280";

          const radius = 8 + point.confidence * 12;

          const marker = L.circleMarker([point.lat, point.lon], {
            radius: radius,
            fillColor: color,
            color: color,
            weight: 2,
            opacity: 0.8,
            fillOpacity: 0.6,
          });

          marker.bindPopup(`
                    <div class="text-sm">
                        <strong>${point.city || "Unknown"}</strong><br>
                        <span style="color: ${color}; font-weight: bold;">${point.sentiment.toUpperCase()}</span><br>
                        Issue: ${point.issue}<br>
                        Confidence: ${(point.confidence * 100).toFixed(1)}%
                    </div>
                `);

          markerCluster.addLayer(marker);
        });
      }

      // ==================== CHART FUNCTIONS ====================
      function initCharts() {
        // Timeline Chart
        const timelineCtx = document
          .getElementById("timeline-chart")
          .getContext("2d");
        timelineChart = new Chart(timelineCtx, {
          type: "line",
          data: {
            labels: [],
            datasets: [
              {
                label: "Sentiment Score",
                data: [],
                borderColor: "#3b82f6",
                backgroundColor: "rgba(59, 130, 246, 0.1)",
                fill: true,
                tension: 0.4,
                pointRadius: 4,
                pointBackgroundColor: "#3b82f6",
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: { display: false },
            },
            scales: {
              x: {
                display: false,
              },
              y: {
                min: -1,
                max: 1,
                grid: { color: "rgba(255,255,255,0.05)" },
                ticks: { color: "#6b7280" },
              },
            },
          },
        });

        // Issue Chart
        const issueCtx = document
          .getElementById("issue-chart")
          .getContext("2d");
        issueChart = new Chart(issueCtx, {
          type: "bar",
          data: {
            labels: [
              "Water",
              "Roads",
              "Employment",
              "Healthcare",
              "Education",
              "General",
            ],
            datasets: [
              {
                data: [0, 0, 0, 0, 0, 0],
                backgroundColor: [
                  "rgba(59, 130, 246, 0.8)",
                  "rgba(249, 115, 22, 0.8)",
                  "rgba(16, 185, 129, 0.8)",
                  "rgba(239, 68, 68, 0.8)",
                  "rgba(168, 85, 247, 0.8)",
                  "rgba(107, 114, 128, 0.8)",
                ],
                borderRadius: 6,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: { display: false },
            },
            scales: {
              x: {
                grid: { display: false },
                ticks: { color: "#6b7280", font: { size: 10 } },
              },
              y: {
                grid: { color: "rgba(255,255,255,0.05)" },
                ticks: { color: "#6b7280" },
              },
            },
          },
        });

        // Sentiment Chart
        const sentimentCtx = document
          .getElementById("sentiment-chart")
          .getContext("2d");
        sentimentChart = new Chart(sentimentCtx, {
          type: "doughnut",
          data: {
            labels: ["Positive", "Negative", "Neutral"],
            datasets: [
              {
                data: [0, 0, 0],
                backgroundColor: [
                  "rgba(16, 185, 129, 0.8)",
                  "rgba(239, 68, 68, 0.8)",
                  "rgba(107, 114, 128, 0.8)",
                ],
                borderWidth: 0,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                position: "bottom",
                labels: { color: "#9ca3af", padding: 15, usePointStyle: true },
              },
            },
            cutout: "65%",
          },
        });
      }

      function updateTimelineChart(data) {
        if (!timelineChart || !data) return;

        const labels = data.map((_, i) => `#${i + 1}`);
        const scores = data.map((d) => d.score);
        const colors = data.map((d) =>
          d.sentiment === "positive"
            ? "#10b981"
            : d.sentiment === "negative"
              ? "#ef4444"
              : "#6b7280",
        );

        timelineChart.data.labels = labels;
        timelineChart.data.datasets[0].data = scores;
        timelineChart.data.datasets[0].pointBackgroundColor = colors;
        timelineChart.update();
      }

      function updateIssueChart(data) {
        if (!issueChart || !data) return;

        issueChart.data.datasets[0].data = [
          data.Water || 0,
          data.Roads || 0,
          data.Employment || 0,
          data.Healthcare || 0,
          data.Education || 0,
          data.General || 0,
        ];
        issueChart.update();
      }

      function updateSentimentChart(data) {
        if (!sentimentChart || !data) return;

        sentimentChart.data.datasets[0].data = [
          data.positive || 0,
          data.negative || 0,
          data.neutral || 0,
        ];
        sentimentChart.update();
      }

      // ==================== ALERTS ====================
      async function loadAlerts() {
        try {
          const response = await fetch("/alerts");
          const data = await response.json();

          // Update badge
          const badge = document.getElementById("alert-badge");
          if (data.unacknowledged > 0) {
            badge.textContent = data.unacknowledged;
            badge.classList.remove("hidden");
          } else {
            badge.classList.add("hidden");
          }

          // Update alert counts
          document.getElementById("alert-high").textContent =
            data.high_severity;
          document.getElementById("alert-medium").textContent =
            data.medium_severity;
          document.getElementById("alert-low").textContent = data.low_severity;

          // Update alert list
          const alertList = document.getElementById("alert-list");

          if (!data.alerts || data.alerts.length === 0) {
            alertList.innerHTML =
              '<p class="text-gray-500 italic text-center py-8">No alerts yet</p>';
            return;
          }

          alertList.innerHTML = data.alerts
            .map(
              (alert) => `
                    <div class="alert-${alert.severity} rounded-xl p-4 slide-in-right">
                        <div class="flex items-start gap-3">
                            <div class="w-8 h-8 rounded-lg ${alert.severity === "high" ? "bg-red-500/20" : alert.severity === "medium" ? "bg-yellow-500/20" : "bg-emerald-500/20"} flex items-center justify-center flex-shrink-0">
                                <svg class="w-4 h-4 ${alert.severity === "high" ? "text-red-400" : alert.severity === "medium" ? "text-yellow-400" : "text-emerald-400"}" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
                                </svg>
                            </div>
                            <div class="flex-1">
                                <p class="text-sm font-semibold text-white">${alert.message}</p>
                                <p class="text-xs text-gray-400 mt-1">${alert.detail}</p>
                                <p class="text-xs text-gray-500 mt-2">${alert.timestamp}</p>
                            </div>
                        </div>
                    </div>
                `,
            )
            .join("");
        } catch (error) {
          console.error("Error loading alerts:", error);
        }
      }

      function toggleAlertCenter() {
        const alertCenter = document.getElementById("alert-center");
        const overlay = document.getElementById("alert-overlay");

        if (alertCenter.classList.contains("translate-x-full")) {
          alertCenter.classList.remove("translate-x-full");
          overlay.classList.remove("hidden");
        } else {
          alertCenter.classList.add("translate-x-full");
          overlay.classList.add("hidden");
        }
      }

      // ==================== AI SUMMARY ====================
      async function loadAISummary() {
        try {
          const response = await fetch("/ai-summary");
          const data = await response.json();

          const summaryDiv = document.getElementById("ai-summary");

          if (data.total_feedback === 0) {
            summaryDiv.innerHTML =
              '<p class="text-gray-500 italic">No analysis data yet. Submit feedback to generate intelligence insights.</p>';
            return;
          }

          // Parse markdown-like formatting
          let formattedSummary = data.summary
            .replace(/\*\*(.*?)\*\*/g, '<strong class="text-white">$1</strong>')
            .replace(/ðŸ“Š/g, '<span class="text-blue-400">ðŸ“Š</span>')
            .replace(/âš ï¸/g, '<span class="text-yellow-400">âš ï¸</span>')
            .replace(/âœ…/g, '<span class="text-emerald-400">âœ…</span>')
            .replace(/ðŸ“ˆ/g, '<span class="text-purple-400">ðŸ“ˆ</span>')
            .replace(/ðŸŽ¯/g, '<span class="text-orange-400">ðŸŽ¯</span>')
            .replace(/ðŸ“/g, '<span class="text-cyan-400">ðŸ“</span>')
            .replace(/ðŸš¨/g, '<span class="text-red-400">ðŸš¨</span>')
            .replace(/âš¡/g, '<span class="text-yellow-400">âš¡</span>')
            .replace(/ðŸŸ¢/g, '<span class="text-emerald-400">ðŸŸ¢</span>');

          summaryDiv.innerHTML = `<p class="leading-relaxed">${formattedSummary}</p>`;
        } catch (error) {
          console.error("Error loading AI summary:", error);
        }
      }

      // ==================== UTILITIES ====================
      function escapeHtml(text) {
        const div = document.createElement("div");
        div.textContent = text;
        return div.innerHTML;
      }

      function showNotification(message, type = "info") {
        // Create notification element
        const notification = document.createElement("div");
        notification.className = `fixed bottom-4 right-4 px-6 py-3 rounded-xl shadow-lg z-50 fade-in ${
          type === "warning"
            ? "bg-yellow-500/90 text-yellow-900"
            : type === "error"
              ? "bg-red-500/90 text-white"
              : "bg-gov-accent/90 text-white"
        }`;
        notification.textContent = message;

        document.body.appendChild(notification);

        // Remove after 4 seconds
        setTimeout(() => {
          notification.remove();
        }, 4000);
      }
    </script>
  </body>
</html>
